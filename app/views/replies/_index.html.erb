<% replies ||= @replies || [] %>
<% replies.each do |reply| %>
  <div class="reply-wrapper" id="reply-<%= reply.id %>">
    <% if reply.is_a?(Sherlock) %>
      <div class="pending-reply info" data-timestamp="<%= reply.created_at.to_i %>">
        <% author_name = @post.posted_anonymously? && @post.author == reply.changed_by ? "Anonymous" : reply.changed_by.username %>
        <% change = if reply.changes.keys.include?("closed_at") %>
          <% reply.changes["closed_at"].last ? "closed" : "reopened" %>
        <% else %>
          <% "edited" %>
        <% end %>
        <%= author_name %> <%= change %> this post <%= timeago(reply.created_at) %>.
      </div>
      <% next %>
    <% end %>

    <% if reply.is_a?(PostInvite) %>
      <div class="pending-reply info" data-timestamp="<%= reply.created_at.to_i %>">
        <strong><%= reply.invited_anonymously? ? "Anonymous" : reply.user.username %></strong> invited <%= pluralize(reply.invited_users, "user") %> <%= timeago(reply.created_at) %>.
      </div>
      <% next %>
    <% end %>

    <% if reply.in_moderation? %>
      <div class="pending-reply" data-timestamp="<%= reply.created_at.to_i %>">This reply from <strong><%= reply.username %></strong> is pending approval.</div>
      <% hidden_by_default = "attached pending" %>
      <% next unless current_mod? %>
    <% elsif reply.removed? || reply.author.banned? || (reply.marked_as_adult? && !current_user&.can_view?(reply)) %>
      <div class="pending-reply removed" data-timestamp="<%= reply.created_at.to_i %>">This reply has been removed.</div>
      <% hidden_by_default = "attached removed" %>
      <% next unless current_mod? %>
    <% end %>

    <%= render partial: "replies/show", locals: { reply: reply, additional_classes: hidden_by_default } %>
  </div>
<% end %>
